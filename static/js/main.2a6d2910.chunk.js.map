{"version":3,"sources":["services/OKExSocket.ts","services/OKExDepth.ts","services/OKExTicker.ts","services/OKExMark.ts","hooks/useOKEx.ts","components/OrderBook/mark.svg","components/OrderBook/index.tsx","App.tsx","index.tsx"],"names":["textEncoder","TextDecoder","OKExSocket","socket","ready","WebSocket","binaryType","Promise","resolve","onopen","onmessage","_handleMessage","bind","message","a","data","this","_decodeMessage","emit","buffer","Uint8Array","indeflateBuffer","pako","responseText","decode","JSON","parse","send","stringify","EventEmitter","OKExDepth","channel","instrumentId","table","bids","Map","asks","on","_handleData","response","forEach","instrumentData","instrument_id","action","ask","price","parseFloat","qty","delete","set","bid","op","args","OKExTicker","last","OKExMark","mark","mark_price","groupOrders","orders","factor","groupValue","orderMap","roundPrice","get","Array","from","entries","addTotal","totalQty","sum","map","useOKEx","useState","setOrders","useSetState","market","setMarket","throttleOrders","useThrottleFn","Math","ceil","slice","floor","totalAsks","reduce","acc","totalBids","reverse","throttleMarket","useThrottle","useEffect","futureService","tickerService","markService","sort","subscribe","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","fill","d","SvgMark","_ref","svgRef","title","titleId","props","viewBox","ref","id","ForwardRef","DEPTHS","OrderBook","setGroupValue","className","htmlFor","name","value","onChange","e","toString","total","pct","style","width","App","console","log","template","document","createElement","innerHTML","content","firstChild","querySelector","appendChild","ReactDOM","render","StrictMode","getElementById"],"mappings":"wTAIMA,EAAc,IAAIC,YAyCTC,E,kDAnCb,aAAe,IAAD,uBACZ,gBAJFC,YAGc,IAFdC,WAEc,EAGZ,IAAMD,EAAS,IAAIE,IAAU,kCAHjB,OAIZF,EAAOG,WAAa,cAEpB,EAAKF,MAAQ,IAAIG,SAAQ,SAACC,GACxBL,EAAOM,OAAS,WACdD,QAIJL,EAAOO,UAAY,EAAKC,eAAeC,KAApB,gBAEnB,EAAKT,OAASA,EAdF,E,yFAiBd,WAAqBU,GAArB,eAAAC,EAAA,sDACQC,EAAOC,KAAKC,eAAeJ,GACjCG,KAAKE,KAAK,OAAQH,GAFpB,gD,mFAKA,SAAeF,GACb,IAAMM,EAAS,IAAIC,WAAWP,EAAQE,MAChCM,EAAkBC,IAAgBH,GAClCI,EAAevB,EAAYwB,OAAOH,GAExC,OAAOI,KAAKC,MAAMH,K,kBAGpB,SAAKR,GACHC,KAAKb,OAAOwB,KAAKF,KAAKG,UAAUb,Q,GAnCXc,KC8EVC,E,kDA5Db,WACU3B,EACR4B,EACQC,GACP,IAAD,8BACA,gBAJQ7B,SAGR,EADQ6B,eACR,EAPFjB,UAOE,IANFkB,WAME,EAEA,EAAKlB,KAAO,CACVmB,KAAM,IAAIC,IACVC,KAAM,IAAID,KAEZ,EAAKF,MAAL,UAAgBF,EAAhB,iBACA5B,EAAOkC,GAAG,OAAQ,EAAKC,YAAY1B,KAAjB,iBAPlB,E,+CAUF,SAAY2B,GAA4B,IAAD,OAC7BN,EAA8BjB,KAA9BiB,MAAOD,EAAuBhB,KAAvBgB,aAAcjB,EAASC,KAATD,KACrBqB,EAAerB,EAAfqB,KAAMF,EAASnB,EAATmB,KAEVK,EAASN,QAAUA,GACrBM,EAASxB,KAAKyB,SAAQ,SAACC,GACjBA,EAAeC,gBAAkBV,IACX,YAApBO,EAASI,QAA4C,WAApBJ,EAASI,SAC5CF,EAAeL,KAAKI,SAAQ,SAACI,GAC3B,IAAMC,EAAQC,WAAWF,EAAI,IACvBG,EAAMD,WAAWF,EAAI,IACZ,MAAXA,EAAI,GACNR,EAAKY,OAAOH,GAEZT,EAAKa,IAAIJ,EAAOE,MAIpBN,EAAeP,KAAKM,SAAQ,SAACU,GAC3B,IAAML,EAAQC,WAAWI,EAAI,IACvBH,EAAMD,WAAWI,EAAI,IACZ,MAAXA,EAAI,GACNhB,EAAKc,OAAOH,GAEZX,EAAKe,IAAIJ,EAAOE,MAIpB,EAAK7B,KAAK,OAAQH,U,8DAO5B,gCAAAD,EAAA,sDACUmB,EAAwBjB,KAAxBiB,MAAOD,EAAiBhB,KAAjBgB,aACTnB,EAAU,CACdsC,GAAI,YACJC,KAAM,CAAC,GAAD,OAAInB,EAAJ,YAAaD,KAGrBhB,KAAKb,OAAOwB,KAAKd,GAPnB,gD,2DAvDsBgB,KCoCTwB,E,kDAjCb,WACUlD,EACR4B,EACQC,GACP,IAAD,8BACA,gBAJQ7B,SAGR,EADQ6B,eACR,EANFC,WAME,EAEA,EAAKA,MAAL,UAAgBF,EAAhB,WACA5B,EAAOkC,GAAG,OAAQ,EAAKC,YAAY1B,KAAjB,iBAHlB,E,+CAMF,SAAY2B,GAA4B,IAAD,OAC7BN,EAAwBjB,KAAxBiB,MAAOD,EAAiBhB,KAAjBgB,aAEXO,EAASN,QAAUA,GACrBM,EAASxB,KAAKyB,SAAQ,SAACC,GACjBA,EAAeC,gBAAkBV,GACnC,EAAKd,KAAK,OAAQ,CAAEoC,KAAMR,WAAWL,EAAea,a,8DAM5D,gCAAAxC,EAAA,sDACUmB,EAAwBjB,KAAxBiB,MAAOD,EAAiBhB,KAAjBgB,aACTnB,EAAU,CACdsC,GAAI,YACJC,KAAM,CAAC,GAAD,OAAInB,EAAJ,YAAaD,KAGrBhB,KAAKb,OAAOwB,KAAKd,GAPnB,gD,2DA3BuBgB,K,wBCwCV0B,E,kDAnCb,WACUpD,EACR4B,EACQC,GACP,IAAD,8BACA,gBAJQ7B,SAGR,EADQ6B,eACR,EANFC,WAME,EAEA,EAAKA,MAAL,UAAgBF,EAAhB,eACA5B,EAAOkC,GAAG,OAAQ,EAAKC,YAAY1B,KAAjB,iBAHlB,E,+CAMF,SAAY2B,GAA4B,IAAD,OAC7BN,EAAwBjB,KAAxBiB,MAAOD,EAAiBhB,KAAjBgB,aAEXO,EAASN,QAAUA,GACrBM,EAASxB,KAAKyB,SAAQ,SAACC,GACjBA,EAAeC,gBAAkBV,GACnC,EAAKd,KAAK,OAAQ,CAChBsC,KAAMV,WAAWL,EAAegB,mB,8DAO1C,gCAAA3C,EAAA,sDACUmB,EAAwBjB,KAAxBiB,MAAOD,EAAiBhB,KAAjBgB,aACTnB,EAAU,CACdsC,GAAI,YACJC,KAAM,CAAC,GAAD,OAAInB,EAAJ,YAAaD,KAGrBhB,KAAKb,OAAOwB,KAAKd,GAPnB,gD,2DA7BqBgB,KCFvB,SAAS6B,EACPC,EACAC,EACAC,GAEA,IADA,EACMC,EAAW,IAAI3B,IADrB,cAEyBwB,GAFzB,IAEA,2BAAiC,CAAC,IAAD,yBAAvBd,EAAuB,KAAhBE,EAAgB,KACzBgB,EAAaH,EAAOf,EAAQgB,GAAcA,EAChDC,EAASb,IAAIc,GAAaD,EAASE,IAAID,IAAe,GAAKhB,IAJ7D,8BAMA,OAAOkB,MAAMC,KAAKJ,EAASK,WAG7B,SAASC,EAAST,EAAiCU,GACjD,IAAIC,EAAM,EACV,OAAOX,EAAOY,KAAI,YAAmB,IAAD,mBAAhB1B,EAAgB,KAATE,EAAS,KAElC,MAAO,CAACF,EAAOE,EADfuB,GAAOvB,EACyB,IAANuB,EAAaD,MAqE5BG,MAjEf,SAAiBzC,EAAiBC,EAAsB6B,GAAqB,IAAD,EAC9CY,mBAAqB,CAC/CvC,KAAM,GACNE,KAAM,KAHkE,mBACnEuB,EADmE,KAC3De,EAD2D,OAM9CC,YAGzB,CACDrB,KAAM,EACNE,KAAM,IAXkE,mBAMnEoB,EANmE,KAM3DC,EAN2D,KAcpEC,EAAiBC,aACrB,SAACpB,EAAoBE,GACnB,IAAMzB,EAAOsB,EAAYC,EAAOvB,KAAM4C,KAAKC,KAAMpB,GAAYqB,MAC3D,EA7Ca,GAgDThD,EAAOwB,EAAYC,EAAOzB,KAAM8C,KAAKG,MAAOtB,GAAYqB,OAhD/C,GAmDTE,EAAYzB,EAAOvB,KAAKiD,QAAO,SAACC,EAAD,UAAkBA,EAAlB,sBAA6B,GAC5DC,EAAY5B,EAAOvB,KAAKiD,QAAO,SAACC,EAAD,UAAkBA,EAAlB,sBAA6B,GAClE,MAAO,CACLlD,KAAMgC,EAAShC,EAAMgD,GAAWI,UAChCtD,KAAMkC,EAASlC,EAAKsD,UAAWD,MAGnC,IACA,CAAC5B,EAAQE,IAEL4B,EAAiBC,YAAYd,EAAQ,IA0B3C,OAxBAe,qBAAU,WACR,sBAAC,kCAAA7E,EAAA,6DACOX,EAAS,IAAID,EACb0F,EAAgB,IAAI9D,EAAU3B,EAAQ4B,EAASC,GAC/C6D,EAAgB,IAAIxC,EAAWlD,EAAQ4B,EAASC,GAChD8D,EAAc,IAAIvC,EAASpD,EAAQ4B,EAASC,GAJnD,SAMO7B,EAAOC,MANd,OAOCwF,EAAcvD,GAAG,QAAQ,SAACtB,GACxB2D,EAAU,CACRtC,KAAM6B,MAAMC,KAAKnD,EAAKqB,KAAK+B,WAAW4B,OACtC7D,KAAM+B,MAAMC,KAAKnD,EAAKmB,KAAKiC,WAAW4B,YAG1CH,EAAcI,YAEdF,EAAYzD,GAAG,QAAQ,SAACtB,GAAD,OAAU8D,EAAU,CAAErB,KAAMzC,EAAKyC,UACxDsC,EAAYE,YAEZH,EAAcxD,GAAG,QAAQ,SAACtB,GAAD,OAAU8D,EAAU,CAAEvB,KAAMvC,EAAKuC,UAC1DuC,EAAcG,YAnBf,2CAAD,KAqBC,CAACjE,EAASC,EAAc0C,EAAWG,IAE/B,CACLlB,OAAQmB,EACRF,OAAQa,IChGZ,SAASQ,IAA2Q,OAA9PA,EAAWC,OAAOC,QAAU,SAAUC,GAAU,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CAAE,IAAIG,EAASF,UAAUD,GAAI,IAAK,IAAII,KAAOD,EAAcN,OAAOQ,UAAUC,eAAeC,KAAKJ,EAAQC,KAAQL,EAAOK,GAAOD,EAAOC,IAAY,OAAOL,IAA2BS,MAAM7F,KAAMsF,WAEhT,SAASQ,EAAyBN,EAAQO,GAAY,GAAc,MAAVP,EAAgB,MAAO,GAAI,IAAkEC,EAAKJ,EAAnED,EAEzF,SAAuCI,EAAQO,GAAY,GAAc,MAAVP,EAAgB,MAAO,GAAI,IAA2DC,EAAKJ,EAA5DD,EAAS,GAAQY,EAAad,OAAOe,KAAKT,GAAqB,IAAKH,EAAI,EAAGA,EAAIW,EAAWT,OAAQF,IAAOI,EAAMO,EAAWX,GAAQU,EAASG,QAAQT,IAAQ,IAAaL,EAAOK,GAAOD,EAAOC,IAAQ,OAAOL,EAFxMe,CAA8BX,EAAQO,GAAuB,GAAIb,OAAOkB,sBAAuB,CAAE,IAAIC,EAAmBnB,OAAOkB,sBAAsBZ,GAAS,IAAKH,EAAI,EAAGA,EAAIgB,EAAiBd,OAAQF,IAAOI,EAAMY,EAAiBhB,GAAQU,EAASG,QAAQT,IAAQ,GAAkBP,OAAOQ,UAAUY,qBAAqBV,KAAKJ,EAAQC,KAAgBL,EAAOK,GAAOD,EAAOC,IAAU,OAAOL,EAMne,IAAI,EAAqB,gBAAoB,OAAQ,CACnDmB,KAAM,eACNC,EAAG,mRAGL,SAASC,EAAQC,EAAMC,GACrB,IAAIC,EAAQF,EAAKE,MACbC,EAAUH,EAAKG,QACfC,EAAQhB,EAAyBY,EAAM,CAAC,QAAS,YAErD,OAAoB,gBAAoB,MAAOzB,EAAS,CACtD8B,QAAS,YACTC,IAAKL,EACL,kBAAmBE,GAClBC,GAAQF,EAAqB,gBAAoB,QAAS,CAC3DK,GAAIJ,GACHD,GAAS,KAAM,GAGpB,IAAIM,EAA0B,aAAiBT,G,GAChC,I,MCxBTU,EAAS,CAAC,GAAK,EAAG,EAAG,GA0EZC,EAxEG,WAAO,IAAD,EACc3D,mBAAS,IADvB,mBACfZ,EADe,KACHwE,EADG,OAEK7D,EAAQ,UAAW,iBAAkBX,GAAxDe,EAFc,EAEdA,OAFc,IAENjB,QACiB,CAAEvB,KAAM,GAAIF,KAAM,IAA3CE,EAHc,EAGdA,KAAMF,EAHQ,EAGRA,KACNoB,EAAesB,EAAftB,KAAME,EAASoB,EAATpB,KAEd,OACE,sBAAK8E,UAAU,aAAf,UACE,sBAAKA,UAAU,QAAf,UACE,4CACA,sBAAKA,UAAU,QAAf,UACE,uBAAOC,QAAQ,QAAf,mBACA,wBACEC,KAAK,QACLC,MAAO5E,EACP6E,SAAU,SAACC,GAAD,OAAON,EAAcvF,WAAW6F,EAAEvC,OAAOqC,SAHrD,SAKGN,EAAO5D,KAAI,SAACiD,GAAD,OACV,wBAA2BiB,MAAOjB,EAAlC,SACGA,GADUA,EAAEoB,uBAOvB,kCACE,gCACE,+BACE,uCACA,qCACA,4CAGJ,uBAAON,UAAU,OAAjB,SACGlG,EAAKmC,KAAI,mCAAE1B,EAAF,KAASE,EAAT,KAAc8F,EAAd,KAAqBC,EAArB,YACR,+BACE,6BAAKjG,IACL,6BAAKE,IACL,qBAAIuF,UAAU,WAAd,UACE,qBAAKS,MAAO,CAAEC,MAAM,GAAD,OAAKF,EAAL,QAClBD,OALIhG,EAAM+F,iBAUnB,uBAAON,UAAU,SAAjB,SACE,+BACE,6BAAKhF,IACL,qBAAIgF,UAAU,OAAd,UACE,cAAC,EAAD,IACC9E,KAEH,4BAGJ,uBAAO8E,UAAU,OAAjB,SACGpG,EAAKqC,KAAI,mCAAE1B,EAAF,KAASE,EAAT,KAAc8F,EAAd,KAAqBC,EAArB,YACR,+BACE,6BAAKjG,IACL,6BAAKE,IACL,qBAAIuF,UAAU,WAAd,UACE,qBAAKS,MAAO,CAAEC,MAAM,GAAD,OAAKF,EAAL,QAClBD,OALIhG,EAAM+F,wBChDZK,I,EAAAA,EAXf,WAQE,OAPAtD,qBAAU,WAAO,IAAD,EACduD,QAAQC,IAAI,OACZ,IAAMC,EAAWC,SAASC,cAAc,YACxCF,EAASG,UAAT,8FACAH,EAASI,QAAQC,aAAjB,UACEJ,SAASK,cAAc,eADzB,OACE,EAAgCC,YAAYP,EAASI,QAAQC,eAC9D,IACI,cAAC,EAAD,KCPHL,EAAWC,SAASC,cAAc,YACxCF,EAASG,UAAT,8FACAH,EAASI,QAAQC,aAAjB,UACEJ,SAASK,cAAc,eADzB,OACE,EAAgCC,YAAYP,EAASI,QAAQC,aAE/DG,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEFT,SAASU,eAAe,W","file":"static/js/main.2a6d2910.chunk.js","sourcesContent":["import WebSocket, { MessageEvent } from \"isomorphic-ws\";\nimport * as pako from \"pako\";\nimport EventEmitter from \"eventemitter3\";\n\nconst textEncoder = new TextDecoder();\n\nclass OKExSocket extends EventEmitter<\"data\"> {\n  socket: WebSocket;\n  ready: Promise<void>;\n\n  constructor() {\n    super();\n\n    const socket = new WebSocket(\"wss://real.okex.com:8443/ws/v3\");\n    socket.binaryType = \"arraybuffer\";\n\n    this.ready = new Promise((resolve) => {\n      socket.onopen = () => {\n        resolve();\n      };\n    });\n\n    socket.onmessage = this._handleMessage.bind(this);\n\n    this.socket = socket;\n  }\n\n  async _handleMessage(message: MessageEvent) {\n    const data = this._decodeMessage(message);\n    this.emit(\"data\", data);\n  }\n\n  _decodeMessage(message: MessageEvent) {\n    const buffer = new Uint8Array(message.data as ArrayBuffer);\n    const indeflateBuffer = pako.inflateRaw(buffer);\n    const responseText = textEncoder.decode(indeflateBuffer);\n\n    return JSON.parse(responseText);\n  }\n\n  send(data: any) {\n    this.socket.send(JSON.stringify(data));\n  }\n}\n\nexport default OKExSocket;\n","import EventEmitter from \"eventemitter3\";\nimport OKExSocket from \"./OKExSocket\";\n\ntype ResponseMessage = {\n  table: string;\n  action: \"partial\" | \"update\";\n  data: Array<{\n    instrument_id: string;\n    asks: Array<[string, string, string, string]>;\n    bids: Array<[string, string, string, string]>;\n  }>;\n};\n\ntype DepthData = {\n  bids: Map<number, number>;\n  asks: Map<number, number>;\n};\n\nclass OKExDepth extends EventEmitter<{\n  data: (data: DepthData) => void;\n}> {\n  data: DepthData;\n  table: string;\n\n  constructor(\n    private socket: OKExSocket,\n    channel: string,\n    private instrumentId: string\n  ) {\n    super();\n    this.data = {\n      bids: new Map<number, number>(),\n      asks: new Map<number, number>(),\n    };\n    this.table = `${channel}/depth_l2_tbt`;\n    socket.on(\"data\", this._handleData.bind(this));\n  }\n\n  _handleData(response: ResponseMessage) {\n    const { table, instrumentId, data } = this;\n    const { asks, bids } = data;\n\n    if (response.table === table) {\n      response.data.forEach((instrumentData) => {\n        if (instrumentData.instrument_id === instrumentId) {\n          if (response.action === \"partial\" || response.action === \"update\") {\n            instrumentData.asks.forEach((ask) => {\n              const price = parseFloat(ask[0]);\n              const qty = parseFloat(ask[1]);\n              if (ask[1] === \"0\") {\n                asks.delete(price);\n              } else {\n                asks.set(price, qty);\n              }\n            });\n\n            instrumentData.bids.forEach((bid) => {\n              const price = parseFloat(bid[0]);\n              const qty = parseFloat(bid[1]);\n              if (bid[1] === \"0\") {\n                bids.delete(price);\n              } else {\n                bids.set(price, qty);\n              }\n            });\n\n            this.emit(\"data\", data);\n          }\n        }\n      });\n    }\n  }\n\n  async subscribe() {\n    const { table, instrumentId } = this;\n    const message = {\n      op: \"subscribe\",\n      args: [`${table}:${instrumentId}`],\n    };\n\n    this.socket.send(message);\n  }\n}\n\nexport default OKExDepth;\n","import EventEmitter from \"eventemitter3\";\nimport OKExSocket from \"./OKExSocket\";\n\ntype ResponseMessage = {\n  table: string;\n  action: \"partial\" | \"update\";\n  data: Array<{\n    instrument_id: string;\n    last: string;\n  }>;\n};\n\ntype TickerData = {\n  last: number;\n};\n\nclass OKExTicker extends EventEmitter<{\n  data: (data: TickerData) => void;\n}> {\n  table: string;\n\n  constructor(\n    private socket: OKExSocket,\n    channel: string,\n    private instrumentId: string\n  ) {\n    super();\n    this.table = `${channel}/ticker`;\n    socket.on(\"data\", this._handleData.bind(this));\n  }\n\n  _handleData(response: ResponseMessage) {\n    const { table, instrumentId } = this;\n\n    if (response.table === table) {\n      response.data.forEach((instrumentData) => {\n        if (instrumentData.instrument_id === instrumentId) {\n          this.emit(\"data\", { last: parseFloat(instrumentData.last) });\n        }\n      });\n    }\n  }\n\n  async subscribe() {\n    const { table, instrumentId } = this;\n    const message = {\n      op: \"subscribe\",\n      args: [`${table}:${instrumentId}`],\n    };\n\n    this.socket.send(message);\n  }\n}\n\nexport default OKExTicker;\n","import EventEmitter from \"eventemitter3\";\nimport OKExSocket from \"./OKExSocket\";\n\ntype ResponseMessage = {\n  table: string;\n  action: \"partial\" | \"update\";\n  data: Array<{\n    instrument_id: string;\n    mark_price: string;\n  }>;\n};\n\ntype TickerData = {\n  mark: number;\n};\n\nclass OKExMark extends EventEmitter<{\n  data: (data: TickerData) => void;\n}> {\n  table: string;\n\n  constructor(\n    private socket: OKExSocket,\n    channel: string,\n    private instrumentId: string\n  ) {\n    super();\n    this.table = `${channel}/mark_price`;\n    socket.on(\"data\", this._handleData.bind(this));\n  }\n\n  _handleData(response: ResponseMessage) {\n    const { table, instrumentId } = this;\n\n    if (response.table === table) {\n      response.data.forEach((instrumentData) => {\n        if (instrumentData.instrument_id === instrumentId) {\n          this.emit(\"data\", {\n            mark: parseFloat(instrumentData.mark_price),\n          });\n        }\n      });\n    }\n  }\n\n  async subscribe() {\n    const { table, instrumentId } = this;\n    const message = {\n      op: \"subscribe\",\n      args: [`${table}:${instrumentId}`],\n    };\n\n    this.socket.send(message);\n  }\n}\n\nexport default OKExMark;\n","import { useEffect, useState } from \"react\";\nimport OKExSocket from \"../services/OKExSocket\";\nimport OKExDepth from \"../services/OKExDepth\";\nimport OKExTicker from \"../services/OKExTicker\";\nimport { useSetState, useThrottle, useThrottleFn } from \"react-use\";\nimport OKExMark from \"../services/OKExMark\";\n\nconst LIMITED_ROWS = 6;\n\ntype OrderState = {\n  bids: Array<[number, number]>;\n  asks: Array<[number, number]>;\n};\n\nfunction groupOrders(\n  orders: Array<[number, number]>,\n  factor: (n: number) => number,\n  groupValue: number\n) {\n  const orderMap = new Map<number, number>();\n  for (let [price, qty] of orders) {\n    const roundPrice = factor(price / groupValue) * groupValue;\n    orderMap.set(roundPrice, (orderMap.get(roundPrice) || 0) + qty);\n  }\n  return Array.from(orderMap.entries());\n}\n\nfunction addTotal(orders: Array<[number, number]>, totalQty: number) {\n  let sum = 0;\n  return orders.map(([price, qty]) => {\n    sum += qty;\n    return [price, qty, sum, (sum * 100) / totalQty];\n  });\n}\n\nfunction useOKEx(channel: string, instrumentId: string, groupValue: number) {\n  const [orders, setOrders] = useState<OrderState>({\n    bids: [],\n    asks: [],\n  });\n\n  const [market, setMarket] = useSetState<{\n    last: number;\n    mark: number;\n  }>({\n    last: 0,\n    mark: 0,\n  });\n\n  const throttleOrders = useThrottleFn(\n    (orders: OrderState, groupValue: number) => {\n      const asks = groupOrders(orders.asks, Math.ceil, groupValue).slice(\n        0,\n        LIMITED_ROWS\n      );\n      const bids = groupOrders(orders.bids, Math.floor, groupValue).slice(\n        -LIMITED_ROWS\n      );\n      const totalAsks = orders.asks.reduce((acc, [, qty]) => acc + qty, 0);\n      const totalBids = orders.asks.reduce((acc, [, qty]) => acc + qty, 0);\n      return {\n        asks: addTotal(asks, totalAsks).reverse(),\n        bids: addTotal(bids.reverse(), totalBids),\n      };\n    },\n    250,\n    [orders, groupValue]\n  );\n  const throttleMarket = useThrottle(market, 10);\n\n  useEffect(() => {\n    (async function () {\n      const socket = new OKExSocket();\n      const futureService = new OKExDepth(socket, channel, instrumentId);\n      const tickerService = new OKExTicker(socket, channel, instrumentId);\n      const markService = new OKExMark(socket, channel, instrumentId);\n\n      await socket.ready;\n      futureService.on(\"data\", (data) => {\n        setOrders({\n          asks: Array.from(data.asks.entries()).sort(),\n          bids: Array.from(data.bids.entries()).sort(),\n        });\n      });\n      futureService.subscribe();\n\n      markService.on(\"data\", (data) => setMarket({ mark: data.mark }));\n      markService.subscribe();\n\n      tickerService.on(\"data\", (data) => setMarket({ last: data.last }));\n      tickerService.subscribe();\n    })();\n  }, [channel, instrumentId, setOrders, setMarket]);\n\n  return {\n    orders: throttleOrders,\n    market: throttleMarket,\n  };\n}\n\nexport default useOKEx;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"currentColor\",\n  d: \"M6,3A1,1 0 0,1 7,4V4.88C8.06,4.44 9.5,4 11,4C14,4 14,6 16,6C19,6 20,4 20,4V12C20,12 19,14 16,14C13,14 13,12 11,12C8,12 7,14 7,14V21H5V4A1,1 0 0,1 6,3M7,7.25V11.5C7,11.5 9,10 11,10C13,10 14,12 16,12C18,12 18,11 18,11V7.5C18,7.5 17,8 16,8C14,8 13,6 11,6C9,6 7,7.25 7,7.25Z\"\n});\n\nfunction SvgMark(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 24 24\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _ref2);\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgMark);\nexport default __webpack_public_path__ + \"static/media/mark.944ec276.svg\";\nexport { ForwardRef as ReactComponent };","import { useState } from \"react\";\nimport useOKEx from \"../../hooks/useOKEx\";\nimport { ReactComponent as Mark } from \"./mark.svg\";\n\nconst DEPTHS = [0.5, 1, 2, 5];\n\nconst OrderBook = () => {\n  const [groupValue, setGroupValue] = useState(0.5);\n  const { market, orders } = useOKEx(\"futures\", \"BTC-USD-210625\", groupValue);\n  const { asks, bids } = orders || { asks: [], bids: [] };\n  const { last, mark } = market;\n\n  return (\n    <div className=\"order-book\">\n      <div className=\"title\">\n        <h5>Order book</h5>\n        <div className=\"depth\">\n          <label htmlFor=\"depth\">Depth</label>\n          <select\n            name=\"depth\"\n            value={groupValue}\n            onChange={(e) => setGroupValue(parseFloat(e.target.value))}\n          >\n            {DEPTHS.map((d) => (\n              <option key={d.toString()} value={d}>\n                {d}\n              </option>\n            ))}\n          </select>\n        </div>\n      </div>\n      <table>\n        <thead>\n          <tr>\n            <th>Price</th>\n            <th>Qty</th>\n            <th>Total</th>\n          </tr>\n        </thead>\n        <tbody className=\"asks\">\n          {asks.map(([price, qty, total, pct]) => (\n            <tr key={price.toString()}>\n              <td>{price}</td>\n              <td>{qty}</td>\n              <td className=\"progress\">\n                <div style={{ width: `${pct}%` }} />\n                {total}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n        <tbody className=\"market\">\n          <tr>\n            <td>{last}</td>\n            <td className=\"mark\">\n              <Mark />\n              {mark}\n            </td>\n            <td></td>\n          </tr>\n        </tbody>\n        <tbody className=\"bids\">\n          {bids.map(([price, qty, total, pct]) => (\n            <tr key={price.toString()}>\n              <td>{price}</td>\n              <td>{qty}</td>\n              <td className=\"progress\">\n                <div style={{ width: `${pct}%` }} />\n                {total}\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n};\n\nexport default OrderBook;\n","import { useEffect } from \"react\";\nimport \"./App.css\";\nimport OrderBook from \"./components/OrderBook\";\n\nfunction App() {\n  useEffect(() => {\n    console.log(\"???\");\n    const template = document.createElement(\"template\");\n    template.innerHTML = `<meta property=\"og:title\"              content=\"When Great Minds Don’t Think Alike\" />`;\n    template.content.firstChild &&\n      document.querySelector(\"head\")?.appendChild(template.content.firstChild);\n  }, []);\n  return <OrderBook />;\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nconst template = document.createElement(\"template\");\ntemplate.innerHTML = `<meta property=\"og:title\"              content=\"When Great Minds Don’t Think Alike\" />`;\ntemplate.content.firstChild &&\n  document.querySelector(\"head\")?.appendChild(template.content.firstChild);\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}